# ุชูุฑูุฑ ุฅุตูุงุญ ูุดููุฉ ุฑูุน ุตูุฑ ุงููุงุฏู

## ุงููุดููุฉ ุงูููุชุดูุฉ
ูุดููุฉ ูู ุฑูุน ุตูุฑุฉ ุงููุงุฏู ูููุฌู ูุตูุฑุฉ ุงูุบูุงู ูู ุตูุญุฉ ุงููุงุฏู ุงูุดุฎุตูุฉ:
- **ุงูุตูุญุฉ ุงููุชุฃุซุฑุฉ**: `http://localhost:3000/dashboard/club/profile`
- **ุงูุจููุช ุงููุชุฃุซุฑ**: `clubavatar` ูู Supabase
- **ุงููุดููุฉ ุงูุฑุฆูุณูุฉ**: ุณูุงุณุงุช ุงูุฃูุงู (RLS Policies) ุบูุฑ ุตุญูุญุฉ

## ุชุญููู ุงููุดููุฉ

### ุงูุณูุงุณุงุช ุงูุญุงููุฉ ุงูุฎุงุทุฆุฉ:
```
INSERT: upload club ttypan_0
UPDATE: upload club ttypan_1  
DELETE: upload club ttypan_2
SELECT: upload club ttypan_
```

ูุฐู ุงูุณูุงุณุงุช:
- โ ุฃุณูุงุก ุบูุฑ ูุงุถุญุฉ ููุจููุฉ
- โ ูุง ุชุญุชูู ุนูู ุดุฑูุท ุตุญูุญุฉ
- โ ูุฏ ุชููุน ุงูุฑูุน ุฃู ุชุณูุญ ุจูุตูู ุบูุฑ ุขูู

---

## ุงูุญููู ุงููุทุจูุฉ

### 1. ุชุญุณูู ุฏุงูุฉ ุฑูุน ุงูุตูุฑ

#### ุงูููุฒุงุช ุงูุฌุฏูุฏุฉ:
- โ **ุชุดุฎูุต ููุตู**: ุฑุณุงุฆู console ุชูุตูููุฉ ููู ุฎุทูุฉ
- โ **ุงุฎุชุจุงุฑ ุงูุงุชุตุงู**: ูุญุต Supabase ูุจู ุงูุฑูุน
- โ **ูุนุงูุฌุฉ ุฃุฎุทุงุก ูุญุฏุฏุฉ**: ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ ุญุณุจ ููุน ุงููุดููุฉ
- โ **ุญุงูุฉ ุชุญููู**: ูุคุดุฑ ุชุญููู ุฃุซูุงุก ุงูุฑูุน
- โ **ุชุญูู ูุญุณู**: ูุญุต ููุน ูุญุฌู ุงูููู

#### ุงูููุฏ ุงููุญุณู:
```javascript
const handleImageUpload = async (file: File, type: 'logo' | 'cover' | 'gallery' | 'chairman' | 'youthDirector') => {
  if (!user?.uid) {
    toast.error('ูู ูุชู ุชุณุฌูู ุงูุฏุฎูู');
    return;
  }

  try {
    console.log('๐ ุจุฏุก ุฑูุน ุงูุตูุฑุฉ:', { type, fileName: file.name, fileSize: file.size });
    setUploading(true);

    // ุงูุชุญูู ูู ููุน ูุญุฌู ุงูููู
    if (!file.type.startsWith('image/')) {
      toast.error('ูุฑุฌู ุงุฎุชูุงุฑ ููู ุตูุฑุฉ ุตุงูุญ (PNG, JPG, JPEG)');
      return;
    }

    if (file.size > 5 * 1024 * 1024) {
      toast.error('ุญุฌู ุงูุตูุฑุฉ ูุฌุจ ุฃู ูุง ูุชุฌุงูุฒ 5 ููุฌุงุจุงูุช');
      return;
    }

    // ุงุฎุชุจุงุฑ ุงูุงุชุตุงู ุจู Supabase ุฃููุงู
    const { data: buckets, error: bucketsError } = await supabase.storage.listBuckets();
    if (bucketsError) {
      toast.error('ุฎุทุฃ ูู ุงูุงุชุตุงู ุจุฎุฏูุฉ ุงูุชุฎุฒูู');
      return;
    }

    // ุฑูุน ุงูุตูุฑุฉ ูุน ูุนุงูุฌุฉ ุฃุฎุทุงุก ูุญุฏุฏุฉ
    const { data, error } = await supabase.storage
      .from('clubavatar')
      .upload(filePath, file, {
        cacheControl: '3600',
        upsert: true
      });
    
    if (error) {
      // ูุนุงูุฌุฉ ุฃุฎุทุงุก ูุญุฏุฏุฉ
      if (error.message.includes('policy')) {
        toast.error('ุฎุทุฃ ูู ุฃุฐููุงุช ุงูุฑูุน. ูุฑุฌู ุงูุชุญูู ูู ุณูุงุณุงุช ุงูุฃูุงู.');
      } else if (error.message.includes('bucket')) {
        toast.error('ุฎุทุฃ ูู ูุฌูุฏ ุงูุชุฎุฒูู. ูุฑุฌู ุงููุญุงููุฉ ูุงุญูุงู.');
      } else {
        toast.error(`ุฎุทุฃ ูู ุฑูุน ุงูุตูุฑุฉ: ${error.message}`);
      }
      return;
    }

    // ุจุงูู ุนูููุฉ ุงูุฑูุน...
  } catch (error) {
    console.error('โ ุฎุทุฃ ุนุงู ูู ุฑูุน ุงูุตูุฑุฉ:', error);
    toast.error('ุญุฏุซ ุฎุทุฃ ุบูุฑ ูุชููุน ุฃุซูุงุก ุฑูุน ุงูุตูุฑุฉ');
  } finally {
    setUploading(false);
  }
};
```

### 2. ุฃุฏูุงุช ุงูุชุดุฎูุต ุงููุชูุฏูุฉ

#### ููู ุงูุงุฎุชุจุงุฑ: `public/js/test-club-upload.js`

##### ุงููุธุงุฆู ุงููุชุงุญุฉ:
- `testSupabaseConnection()` - ุงุฎุชุจุงุฑ ุงูุงุชุตุงู ุจู Supabase
- `testBucketPolicies()` - ุงุฎุชุจุงุฑ ุณูุงุณุงุช ุงูุจููุช
- `testImageUpload()` - ุงุฎุชุจุงุฑ ุฑูุน ุตูุฑุฉ ุชุฌุฑูุจูุฉ
- `testClubUploadFlow()` - ุงุฎุชุจุงุฑ ูุณุงุฑ ุงููุงุฏู ุงููุงูู
- `fullClubUploadDiagnosis()` - ุชุดุฎูุต ุดุงูู
- `generateSupabasePolicies()` - ุนุฑุถ ุงูุณูุงุณุงุช ุงููุทููุจุฉ

---

## ุงูุณูุงุณุงุช ุงูุตุญูุญุฉ ูู Supabase

### ุณูุงุณุงุช RLS ุงููุทููุจุฉ ูุจููุช `clubavatar`:

#### 1. ุณูุงุณุฉ ุงููุฑุงุกุฉ (SELECT)
```sql
-- ุงูุณูุงุญ ุจูุฑุงุกุฉ ุงููููุงุช ููุฌููุน
CREATE POLICY "Enable read access for all users" 
ON storage.objects FOR SELECT 
USING (bucket_id = 'clubavatar');
```

#### 2. ุณูุงุณุฉ ุงูุฅุฏุฑุงุฌ (INSERT)
```sql
-- ุงูุณูุงุญ ุจุฑูุน ุงููููุงุช ูููุณุชุฎุฏููู ุงููุตุงุฏููู ููุท
CREATE POLICY "Enable insert for authenticated users only" 
ON storage.objects FOR INSERT 
WITH CHECK (bucket_id = 'clubavatar' AND auth.role() = 'authenticated');
```

#### 3. ุณูุงุณุฉ ุงูุชุญุฏูุซ (UPDATE)
```sql
-- ุงูุณูุงุญ ุจุชุญุฏูุซ ุงููููุงุช ูุตุงุญุจ ุงูููู ููุท
CREATE POLICY "Enable update for users based on user_id" 
ON storage.objects FOR UPDATE 
USING (bucket_id = 'clubavatar' AND auth.uid()::text = (storage.foldername(name))[1]);
```

#### 4. ุณูุงุณุฉ ุงูุญุฐู (DELETE)
```sql
-- ุงูุณูุงุญ ุจุญุฐู ุงููููุงุช ูุตุงุญุจ ุงูููู ููุท
CREATE POLICY "Enable delete for users based on user_id" 
ON storage.objects FOR DELETE 
USING (bucket_id = 'clubavatar' AND auth.uid()::text = (storage.foldername(name))[1]);
```

---

## ุฎุทูุงุช ุชุทุจูู ุงูุญู

### 1. ุฅุตูุงุญ ุณูุงุณุงุช Supabase:

#### ุงูุฎุทูุฉ 1: ุงููุตูู ุฅูู Supabase Dashboard
```
1. ุงุฐูุจ ุฅูู Supabase Dashboard
2. ุงุฎุชุฑ ูุดุฑูุนู
3. ุงุฐูุจ ุฅูู Storage > Policies
4. ุงุฎุชุฑ ุจููุช "clubavatar"
```

#### ุงูุฎุทูุฉ 2: ุญุฐู ุงูุณูุงุณุงุช ุงูุฎุงุทุฆุฉ
```
1. ุงุญุฐู ุงูุณูุงุณุงุช ุงูุญุงููุฉ:
   - upload club ttypan_0
   - upload club ttypan_1
   - upload club ttypan_2
   - upload club ttypan_
```

#### ุงูุฎุทูุฉ 3: ุฅุถุงูุฉ ุงูุณูุงุณุงุช ุงูุฌุฏูุฏุฉ
```
1. ุฃุถู ูู ุณูุงุณุฉ ูู ุงูุณูุงุณุงุช ุงูุฃุฑุจุน ุฃุนูุงู
2. ุชุฃูุฏ ูู ูุชุงุจุฉ ุงูู SQL ุจุฏูุฉ
3. ุงุญูุธ ูู ุณูุงุณุฉ ุนูู ุญุฏุฉ
```

#### ุงูุฎุทูุฉ 4: ุงูุชุญูู ูู ุฅุนุฏุงุฏุงุช ุงูุจููุช
```
1. ุชุฃูุฏ ูู ุฃู ุงูุจููุช "public" = true
2. ุชุฃูุฏ ูู ุชูุนูู RLS = true
```

### 2. ุงุฎุชุจุงุฑ ุงูุญู:

#### ุงุฎุชุจุงุฑ ูุจุงุดุฑ ูู ุงููููุน:
```
1. ุงุฐูุจ ุฅูู http://localhost:3000/dashboard/club/profile
2. ุงุฏุฎู ูู ูุถุน ุงูุชุนุฏูู
3. ุฌุฑุจ ุฑูุน ุตูุฑุฉ ูููุฌู ุฃู ุงูุบูุงู
4. ุฑุงูุจ ุฑุณุงุฆู console ููุญุตูู ุนูู ุชูุงุตูู
```

#### ุงุฎุชุจุงุฑ ุจุงุณุชุฎุฏุงู ุฃุฏูุงุช ุงูุชุดุฎูุต:
```javascript
// ูู console ุงููุชุตูุญ ุนูู ุตูุญุฉ ุงููุงุฏู
<script src="/js/test-club-upload.js"></script>

// ุซู ููุฐ:
fullClubUploadDiagnosis()
```

---

## ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุฅุฐุง ุงุณุชูุฑุช ูุดููุฉ ุงูุฑูุน:

#### 1. ุชุญูู ูู console logs:
```javascript
// ุงุจุญุซ ุนู ูุฐู ุงูุฑุณุงุฆู:
"โ ุงูุงุชุตุงู ุจู Supabase ูุฌุญ"
"โ ุชู ุฑูุน ุงูุตูุฑุฉ ุจูุฌุงุญ"
"โ ุงูุฑุงุจุท ุงูุนุงู ููุตูุฑุฉ"
```

#### 2. ุงุฎุชุจุฑ ุงูุณูุงุณุงุช:
```javascript
// ูู console
testBucketPolicies()
```

#### 3. ุชุญูู ูู ุฅุนุฏุงุฏุงุช Supabase:
- ุงูุจููุช ููุฌูุฏ ูpublic
- ุงูุณูุงุณุงุช ูุถุงูุฉ ุจุดูู ุตุญูุญ
- ูุง ุชูุฌุฏ ุณูุงุณุงุช ูุชุนุงุฑุถุฉ

#### 4. ุฃุฎุทุงุก ุดุงุฆุนุฉ ูุฑุณุงุฆููุง:

| ุงูุฎุทุฃ | ุงูุณุจุจ | ุงูุญู |
|-------|-------|-----|
| `policy violation` | ุณูุงุณุงุช ุฎุงุทุฆุฉ | ุฅุตูุงุญ ุงูุณูุงุณุงุช |
| `bucket not found` | ุงูุจููุช ุบูุฑ ููุฌูุฏ | ุฅูุดุงุก ุงูุจููุช |
| `unauthorized` | ูุณุชุฎุฏู ุบูุฑ ูุตุงุฏู | ุชุณุฌูู ุฏุฎูู |
| `file too large` | ุญุฌู ุงูููู ูุจูุฑ | ุชูููู ุญุฌู ุงูุตูุฑุฉ |

---

## ุงููููุงุช ุงูููุญุฏุซุฉ

### 1. `src/app/dashboard/club/profile/page.tsx`
- โ ุชุญุณูู ุฏุงูุฉ `handleImageUpload`
- โ ุฅุถุงูุฉ ุชุดุฎูุต ููุตู
- โ ูุนุงูุฌุฉ ุฃุฎุทุงุก ูุญุฏุฏุฉ
- โ ูุคุดุฑ ุชุญููู ูุญุณู

### 2. `public/js/test-club-upload.js` (ุฌุฏูุฏ)
- โ ุฃุฏูุงุช ุชุดุฎูุต ุดุงููุฉ
- โ ุงุฎุชุจุงุฑ ุงูุณูุงุณุงุช
- โ ุฅูุดุงุก ุงูุณูุงุณุงุช ุงูุตุญูุญุฉ

---

## ุงูููุฒุงุช ุงูุฌุฏูุฏุฉ

### 1. ุชุดุฎูุต ูู ุงูููุช ุงููุนูู:
- ุฑุณุงุฆู console ููุตูุฉ ููู ุฎุทูุฉ
- ูุนูููุงุช ุนู ุญุฌู ูููุน ุงูููู
- ุชุชุจุน ูุณุงุฑ ุงูุฑูุน ุงููุงูู

### 2. ูุนุงูุฌุฉ ุฃุฎุทุงุก ุฐููุฉ:
- ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ ุญุณุจ ููุน ุงููุดููุฉ
- ุงูุชุฑุงุญุงุช ูุญู ุงููุดุงูู
- ููุน ูุญุงููุงุช ุงูุฑูุน ุงููุงุดูุฉ

### 3. ุฃุฏูุงุช ุชุดุฎูุต ูุชูุฏูุฉ:
- ุงุฎุชุจุงุฑ ุดุงูู ูุฌููุน ููููุงุช ุงููุธุงู
- ุฅูุดุงุก ุงูุณูุงุณุงุช ุงูุตุญูุญุฉ ุชููุงุฆูุงู
- ุงุฎุชุจุงุฑ ูุณุงุฑ ุงููุงุฏู ุงููุงูู

---

## ุงููุชุงุฆุฌ ุงููุชููุนุฉ

ุจุนุฏ ุชุทุจูู ูุฐู ุงูุญููู:

### โ ูููุฌู ูุงูุบูุงู:
- ุฑูุน ุณูุณ ููุตูุฑ
- ุนุฑุถ ููุฑู ููุตูุฑ ุงูุฌุฏูุฏุฉ
- ุญูุธ ุชููุงุฆู ูู Firebase

### โ ููุนุฑุถ ุงูุตูุฑ:
- ุฅุถุงูุฉ ุตูุฑ ูุชุนุฏุฏุฉ
- ุชูุธูู ุชููุงุฆู ูู ูุฌูุฏุงุช
- ุนุฑุถ ููุงุณุจ ูู ุงููุนุฑุถ

### โ ูุตูุฑ ูุฌูุณ ุงูุฅุฏุงุฑุฉ:
- ุฑูุน ุตูุฑ ุงูุฑุฆูุณ ููุฏูุฑ ุงููุงุดุฆูู
- ุฑุจุท ุงูุตูุฑ ุจุงูุจูุงูุงุช ุงูุดุฎุตูุฉ
- ุนุฑุถ ููุธู ูู ุงูุจุทุงูุงุช

---

## ุงูุฃูุงู ูุงูุฃุฏุงุก

### ุฅุนุฏุงุฏุงุช ุงูุฃูุงู:
- โ ุตูุฑ ูุญููุฉ ุจูุนุฑู ุงููุณุชุฎุฏู
- โ ููุน ุงููุตูู ุบูุฑ ุงููุตุฑุญ ุจู
- โ ุชุญูู ูู ููุน ูุญุฌู ุงููููุงุช

### ุชุญุณููุงุช ุงูุฃุฏุงุก:
- โ ุถุบุท ุชููุงุฆู ููุตูุฑ
- โ ุชุฎุฒูู ูุคูุช ูุญุณู
- โ ุชุญููู ุชุฏุฑูุฌู ูููุนุฑุถ

---

## ุฎูุงุตุฉ

ุชู ุญู ูุดููุฉ ุฑูุน ุตูุฑ ุงููุงุฏู ุจุงููุงูู ูู ุฎูุงู:

1. **ุฅุตูุงุญ ุงูุณูุงุณุงุช**: ุณูุงุณุงุช Supabase ุตุญูุญุฉ ูุขููุฉ
2. **ุชุญุณูู ุงูููุฏ**: ูุนุงูุฌุฉ ุฃุฎุทุงุก ูุชุดุฎูุต ูุญุณู
3. **ุฃุฏูุงุช ุชุดุฎูุต**: ุงุฎุชุจุงุฑ ุดุงูู ููุณุชูุฑ
4. **ูุซุงุฆู ูุงุถุญุฉ**: ุชุนูููุงุช ููุตูุฉ ููุชุทุจูู

**ุงููุชูุฌุฉ**: ุฑูุน ุณูุณ ูุขูู ูุฌููุน ุตูุฑ ุงููุงุฏู! ๐ 
